
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link rel="shortcut icon" href="favicon.ico">
  <title>hara.io.scheduler - easy and intuitive task scheduling</title>
  <script src="js/highlight.min.js"></script>
  <script src="js/gumshoe.min.js"></script>
  <script src="js/smooth-scroll.min.js"></script>
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/poole.css">
  <link rel="stylesheet" href="css/syntax.css">
  <link rel="stylesheet" href="css/lanyon.css">
  <link rel="stylesheet" href="css/bolton.css">
  <link rel="stylesheet" href="css/bolton-api.css">
  <link rel="stylesheet" href="css/bolton-highlight.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  
</head>

  <body class="theme-base-08">
    <span id="page-top"></span>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <nav class="sidebar-nav">
    <span>&nbsp;</span>
    <a class="sidebar-nav-item header" href="index.html"><img src="img/logo-white.png"/></a>
    <span>&nbsp;</span>
    <a class="sidebar-nav-item" href="hara-benchmark.html">benchmark</a><a class="sidebar-nav-item" href="hara-class.html">class</a><a class="sidebar-nav-item" href="hara-common.html">common</a><a class="sidebar-nav-item" href="hara-component.html">component</a><a class="sidebar-nav-item" href="hara-concurrent.html">concurrent</a><a class="sidebar-nav-item" href="hara-concurrent-ova.html">concurrent.ova</a><a class="sidebar-nav-item" href="hara-concurrent-procedure.html">concurrent.procedure</a><a class="sidebar-nav-item" href="hara-data.html">data</a><a class="sidebar-nav-item" href="hara-event.html">event</a><a class="sidebar-nav-item" href="hara-expression.html">expression</a><a class="sidebar-nav-item" href="hara-extend.html">extend</a><a class="sidebar-nav-item" href="hara-function.html">function</a><a class="sidebar-nav-item" href="hara-group.html">group</a><a class="sidebar-nav-item" href="hara-io.html">io</a><a class="sidebar-nav-item" href="hara-io-file.html">io.file</a><a class="sidebar-nav-item" href="hara-io-profiler.html">io.profiler</a><a class="sidebar-nav-item active" href="hara-io-scheduler.html">io.scheduler</a><a class="sidebar-nav-item" href="hara-io-watch.html">io.watch</a><a class="sidebar-nav-item" href="hara-namespace.html">namespace</a><a class="sidebar-nav-item" href="hara-object.html">object</a><a class="sidebar-nav-item" href="hara-reflect.html">reflect</a><a class="sidebar-nav-item" href="hara-security.html">security</a><a class="sidebar-nav-item" href="hara-sort.html">sort</a><a class="sidebar-nav-item" href="hara-string.html">string</a><a class="sidebar-nav-item" href="hara-test.html">test</a><a class="sidebar-nav-item" href="hara-time.html">time</a><a class="sidebar-nav-item" href="hara-zip.html">zip</a>
    <span class="sidebar-nav-item">&nbsp;</span>
    <span class="sidebar-nav-item">&nbsp;</span>
  </nav>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <span>hara.io.scheduler</span>
            <small>easy and intuitive task scheduling</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="page">
          <div class="heading">
            <div>
              <h5>Author: Chris Zheng&nbsp;&nbsp;<a href="mailto:z@caudate.me">(z@caudate.me)</a></h5>
              <h5>Date: 29 June 2017</h5>
              <h5>Repository: <a href="https://github.com/zcaudate/hara">https://github.com/zcaudate/hara</a></h5>
              <h5>Version: 2.5.10</h5></div></div>
          <hr/>
          <div class="outline">
            <div class="toc">
              <nav data-gumshoe-header>
                <ul data-gumshoe>
                  <a data-scroll class="top" href="#page-top">TOP</a>
                  <li><a class="chapter" data-scroll="" href="#introduction"><h4>1 &nbsp; Introduction</h4></a><a class="section" data-scroll="" href="#installation"><h5><i>1.1 &nbsp; Installation</i></h5></a><a class="section" data-scroll="" href="#motivation"><h5><i>1.2 &nbsp; Motivation</i></h5></a><a class="section" data-scroll="" href="#other-libraries"><h5><i>1.3 &nbsp; Other Libraries</i></h5></a></li><li><a class="chapter" data-scroll="" href="#index"><h4>2 &nbsp; Index</h4></a></li><li><a class="chapter" data-scroll="" href="#api"><h4>3 &nbsp; API</h4></a><a class="section" data-scroll="" href="#scheduler"><h5><i>3.1 &nbsp; Scheduler</i></h5></a><a class="section" data-scroll="" href="#tasks"><h5><i>3.2 &nbsp; Tasks</i></h5></a><a class="section" data-scroll="" href="#instances"><h5><i>3.3 &nbsp; Instances</i></h5></a><a class="section" data-scroll="" href="#simulation"><h5><i>3.4 &nbsp; Simulation</i></h5></a></li><li><a class="chapter" data-scroll="" href="#walkthrough"><h4>4 &nbsp; Walkthrough</h4></a><a class="section" data-scroll="" href="#schedule"><h5><i>4.1 &nbsp; Schedule</i></h5></a><a class="section" data-scroll="" href="#simulation-0"><h5><i>4.2 &nbsp; Simulation</i></h5></a><a class="section" data-scroll="" href="#interval-and-pause"><h5><i>4.3 &nbsp; Interval and Pause</i></h5></a><a class="section" data-scroll="" href="#globals"><h5><i>4.4 &nbsp; Globals</i></h5></a><a class="section" data-scroll="" href="#date-type"><h5><i>4.5 &nbsp; Date Type</i></h5></a><a class="section" data-scroll="" href="#timezone"><h5><i>4.6 &nbsp; Timezone</i></h5></a><a class="section" data-scroll="" href="#upgrade-from-cronj"><h5><i>4.7 &nbsp; Upgrade from Cronj</i></h5></a></li>
                </ul>
              </nav>
            </div>
          </div>

          <div class="toc">
              <nav>
                <ul>
                  <li><a class="chapter" data-scroll="" href="#introduction"><h4>1 &nbsp; Introduction</h4></a><a class="section" data-scroll="" href="#installation"><h5><i>1.1 &nbsp; Installation</i></h5></a><a class="section" data-scroll="" href="#motivation"><h5><i>1.2 &nbsp; Motivation</i></h5></a><a class="section" data-scroll="" href="#other-libraries"><h5><i>1.3 &nbsp; Other Libraries</i></h5></a></li><li><a class="chapter" data-scroll="" href="#index"><h4>2 &nbsp; Index</h4></a></li><li><a class="chapter" data-scroll="" href="#api"><h4>3 &nbsp; API</h4></a><a class="section" data-scroll="" href="#scheduler"><h5><i>3.1 &nbsp; Scheduler</i></h5></a><a class="section" data-scroll="" href="#tasks"><h5><i>3.2 &nbsp; Tasks</i></h5></a><a class="section" data-scroll="" href="#instances"><h5><i>3.3 &nbsp; Instances</i></h5></a><a class="section" data-scroll="" href="#simulation"><h5><i>3.4 &nbsp; Simulation</i></h5></a></li><li><a class="chapter" data-scroll="" href="#walkthrough"><h4>4 &nbsp; Walkthrough</h4></a><a class="section" data-scroll="" href="#schedule"><h5><i>4.1 &nbsp; Schedule</i></h5></a><a class="section" data-scroll="" href="#simulation-0"><h5><i>4.2 &nbsp; Simulation</i></h5></a><a class="section" data-scroll="" href="#interval-and-pause"><h5><i>4.3 &nbsp; Interval and Pause</i></h5></a><a class="section" data-scroll="" href="#globals"><h5><i>4.4 &nbsp; Globals</i></h5></a><a class="section" data-scroll="" href="#date-type"><h5><i>4.5 &nbsp; Date Type</i></h5></a><a class="section" data-scroll="" href="#timezone"><h5><i>4.6 &nbsp; Timezone</i></h5></a><a class="section" data-scroll="" href="#upgrade-from-cronj"><h5><i>4.7 &nbsp; Upgrade from Cronj</i></h5></a></li>
                </ul>
              </nav>
          </div>
          <div><span id="introduction"></span><h2><b>1 &nbsp;&nbsp; Introduction</b></h2></div><div><span id="installation"></span><h3>1.1 &nbsp;&nbsp; Installation</h3></div><div><p>Add to <code>project.clj</code> dependencies:</p><pre><code>&#91;zcaudate/hara.io.scheduler &quot;2.5.10&quot;&#93;</code></pre></div><div><p>All functions are in the <code>hara.io.scheduler</code> namespace.</p></div><div class="code"><pre><code class="clojure">(use 'hara.io.scheduler)</code></pre></div><div><span id="motivation"></span><h3>1.2 &nbsp;&nbsp; Motivation</h3></div><div><p><code>hara.io.scheduler</code> provides an easy and intuitive interface for task scheduling. Much emphasis has been placed on task management, including the ability to inspect and kill active tasks. Furthermore, testing time is reduced as the library includes a simulation framework to enable speed-up of the original schedule.</p></div><div><span id="other-libraries"></span><h3>1.3 &nbsp;&nbsp; Other Libraries</h3></div><div><p><code>hara.io.scheduler</code> is just one of many scheduling libraries in the clojure world including:</p><ul><li><a href='https://github.com/overtone/at-at'>at-at</a></li><li><a href='https://github.com/james-henderson/chime'>chime</a></li><li><a href='https://github.com/kognate/clj-cronlike'>clj-cronlike</a></li><li><a href='http://www.sauronsoftware.it/projects/cron4j'>cron4j</a></li><li><a href='https://github.com/aredington/monotony'>monotony</a></li><li><a href='https://github.com/michaelklishin/quartzite'>quartzite</a></li><li><a href='https://github.com/AdamClements/schejulure'>schejulure</a></li></ul></div><div><span id="index"></span><h2><b>2 &nbsp;&nbsp; Index</b></h2></div><div class="api"><span id="entry__hara_io_scheduler__"></span><hr /><div><ul><li><a data-scroll="" href="#entry__hara_io_scheduler__add_task">add-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__delete_task">delete-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__disable_task">disable-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__empty_tasks">empty-tasks</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__enable_task">enable-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__get_instance">get-instance</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__get_task">get-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__kill_instance">kill-instance</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__kill_instances">kill-instances</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__list_instances">list-instances</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__list_tasks">list-tasks</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__reparametise_task">reparametise-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__reschedule_task">reschedule-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__restart_BANG_">restart!</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__running_QMARK_">running?</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__scheduler">scheduler</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__shutdown_BANG_">shutdown!</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__simulate">simulate</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__start_BANG_">start!</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__stop_BANG_">stop!</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__stopped_QMARK_">stopped?</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__trigger_BANG_">trigger!</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__uptime">uptime</a></li></ul></div></div><div><span id="api"></span><h2><b>3 &nbsp;&nbsp; API</b></h2></div><div><span id="scheduler"></span><h3>3.1 &nbsp;&nbsp; Scheduler</h3></div><div class="api"><span id="entry__hara_io_scheduler__"></span><hr /><div><ul><li><a data-scroll="" href="#entry__hara_io_scheduler__scheduler">scheduler</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__start_BANG_">start!</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__stop_BANG_">stop!</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__shutdown_BANG_">shutdown!</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__running_QMARK_">running?</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__stopped_QMARK_">stopped?</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__uptime">uptime</a></li></ul><hr style="margin-bottom: 0" /><div><div class="entry"><span id="entry__hara_io_scheduler__scheduler"></span><div class="entry-description"><h4><b>scheduler&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>creates a schedular from handlers, or both handlers and config</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L27-L51" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__scheduler" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__scheduler"></label><pre class="source"><code class="clojure">(defn scheduler
  ([handlers] (scheduler handlers {}))
  ([handlers config] (scheduler handlers config {}))
  ([handlers config global]
   (component/system
    {:array     [{:constructor (array/seed-fn handlers)
                  :setup array/initialise} :cache :registry :ticker]
     :clock     [clock/clock :ticker]
     :ticker    [(fn [_] (atom {:time nil :array nil}))]
     :registry  [(fn [_] (data/registry))]
     :cache     [(fn [_] (data/cache))]}
    (-> global
        (update-in [:array] nested/merge-nested config)
        (nested/merge-nil-nested *defaults*))
    {:tag "scheduler"})))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L8-L16" target="_blank">link</a></i></h6><code class="clojure">(def sch (scheduler
          {:print-task-1
           {:handler (fn [t] (Thread/sleep 2000))
            :schedule "/5 * * * * * *"}
           :print-task-2
           {:handler (fn [t] (Thread/sleep 2000))
            :schedule "/2 * * * * * *"}}))</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__start_BANG_"></span><div class="entry-description"><h4><b>start!&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>starts the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L53-L74" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__start_BANG_" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__start_BANG_"></label><pre class="source"><code class="clojure">(defn start!
  [scheduler]
  (component/start scheduler))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L19-L36" target="_blank">link</a></i></h6><code class="clojure">(start! sch)
;; => {:ticker {:time #inst "2016-10-25T01:20:06.000-00:00",
;;              :array [6 20 8 2 25 10 2016]}
;;     :clock {:start-time #inst "2016-10-25T01:18:52.184-00:00",
;;             :current-time #inst "2016-10-25T01:20:06.001-00:00",
;;             :running true},
;;     :cache {},
;;     :registry {:print-task-2 (#inst "2016-10-25T01:20:06.000-00:00"),
;;                :print-task-1 (#inst "2016-10-25T01:20:05.000-00:00")},
;;     :array {:handlers [],
;;             :ticker {:time #inst "2016-10-25T01:20:06.000-00:00",
;;                      :array [6 20 8 2 25 10 2016]}
;;             :registry {:print-task-2 (#inst "2016-10-25T01:20:06.000-00:00"),
;;                        :print-task-1 (#inst "2016-10-25T01:20:05.000-00:00")},
;;             :cache {}}}</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__stop_BANG_"></span><div class="entry-description"><h4><b>stop!&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>stops the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L76-L99" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__stop_BANG_" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__stop_BANG_"></label><pre class="source"><code class="clojure">(defn stop!
  [scheduler]
  (component/stop scheduler))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L39-L58" target="_blank">link</a></i></h6><code class="clojure">(stop! sch)
;; Schedule will stop but running instances will continue to run until completion
;;
;; => {:array {:handlers
;;             [{:status :ready,
;;               :val {:name :print-task-1,
;;                     :mode :async,
;;                     :arglist [:timestamp :params :instance]}} 
;;              {:status :ready,
;;               :val {:name :print-task-2,
;;                     :mode :async,
;;                     :arglist [:timestamp :params :instance]}}]},
;;     :registry #reg {},
;;     :cache #cache {},
;;     :clock #clock {:start-time nil, :current-time nil, :running false},
;;     :ticker {:time #inst "2016-10-25T01:22:58.000-00:00",
;;              :array [58 22 8 2 25 10 2016]}}</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__shutdown_BANG_"></span><div class="entry-description"><h4><b>shutdown!&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>forcibly shuts down the scheduler, immediately killing all running threads</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L346-L355" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__shutdown_BANG_" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__shutdown_BANG_"></label><pre class="source"><code class="clojure">(defn shutdown!
  [scheduler]
  (kill-instances scheduler)
  (stop! scheduler))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L202-L206" target="_blank">link</a></i></h6><code class="clojure">(shutdown! sch)
;; All tasks will stop and all running instances killed</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__running_QMARK_"></span><div class="entry-description"><h4><b>running?&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>checks to see if the scheduler is running</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L110-L117" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__running_QMARK_" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__running_QMARK_"></label><pre class="source"><code class="clojure">(defn running?
  [scheduler]
  (component/started? (:clock scheduler)))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L67-L70" target="_blank">link</a></i></h6><code class="clojure">(running? sch)
=> false</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__stopped_QMARK_"></span><div class="entry-description"><h4><b>stopped?&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>checks to see if the scheduler is stopped</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L101-L108" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__stopped_QMARK_" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__stopped_QMARK_"></label><pre class="source"><code class="clojure">(defn stopped?
  [scheduler]
  (component/stopped? (:clock scheduler)))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L61-L64" target="_blank">link</a></i></h6><code class="clojure">(stopped? sch)
=> true</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__uptime"></span><div class="entry-description"><h4><b>uptime&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>checks to see how long the scheduler has been running</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L152-L166" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__uptime" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__uptime"></label><pre class="source"><code class="clojure">(defn uptime
  [scheduler]
  (if-let [start (-> scheduler :clock deref :start-time)]
    (-  (System/currentTimeMillis)
        (time/to-long start))))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L85-L93" target="_blank">link</a></i></h6><code class="clojure">(uptime sch) ;; when the scheduler is stopped, uptime is `nil`
=> nil

(start! sch)

(uptime sch) ;; uptime is from when the scheduler is started
=> 7936</code></pre></div></div></div></div><div><span id="tasks"></span><h3>3.2 &nbsp;&nbsp; Tasks</h3></div><div class="api"><span id="entry__hara_io_scheduler__"></span><hr /><div><ul><li><a data-scroll="" href="#entry__hara_io_scheduler__add_task">add-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__delete_task">delete-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__disable_task">disable-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__empty_tasks">empty-tasks</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__enable_task">enable-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__get_task">get-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__list_tasks">list-tasks</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__reparametise_task">reparametise-task</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__reschedule_task">reschedule-task</a></li></ul><hr style="margin-bottom: 0" /><div><div class="entry"><span id="entry__hara_io_scheduler__add_task"></span><div class="entry-description"><h4><b>add-task&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>add a task to the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L233-L242" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__add_task" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__add_task"></label><pre class="source"><code class="clojure">(defn add-task
  [scheduler name props]
  (dosync (ova/append! (-> scheduler :array :handlers)
                       (array/build-handler name props {}))))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L141-L145" target="_blank">link</a></i></h6><code class="clojure">(add-task (scheduler {})
          :hello {:handler (fn [t params] (println params))
                  :schedule "* * * * * * *"
                  :params {:data "foo"}})</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__delete_task"></span><div class="entry-description"><h4><b>delete-task&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>deletes a specific task in the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L217-L223" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__delete_task" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__delete_task"></label><pre class="source"><code class="clojure">(defn delete-task
  [scheduler name]
  (dosync (ova/remove! (-> scheduler :array :handlers) [:name name])))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L131-L133" target="_blank">link</a></i></h6><code class="clojure">(delete-task sch :print-task-2)</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__disable_task"></span><div class="entry-description"><h4><b>disable-task&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>disables a specific task in the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L206-L215" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__disable_task" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__disable_task"></label><pre class="source"><code class="clojure">(defn disable-task
  [scheduler name]
  (dosync (ova/smap! (-> scheduler :array :handlers) [:name name]
                     assoc :disabled true)))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L124-L128" target="_blank">link</a></i></h6><code class="clojure">(disable-task sch :print-task-1)
;; Task is disabled when `start!` is called</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__empty_tasks"></span><div class="entry-description"><h4><b>empty-tasks&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>clears all tasks in the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L225-L231" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__empty_tasks" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__empty_tasks"></label><pre class="source"><code class="clojure">(defn empty-tasks
  [scheduler]
  (dosync (ova/empty! (-> scheduler :array :handlers))))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L136-L138" target="_blank">link</a></i></h6><code class="clojure">(empty-tasks sch)</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__enable_task"></span><div class="entry-description"><h4><b>enable-task&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>enables a specific task in the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L195-L204" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__enable_task" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__enable_task"></label><pre class="source"><code class="clojure">(defn enable-task
  [scheduler name]
  (dosync (ova/smap! (-> scheduler :array :handlers) [:name name]
                     dissoc :disabled)))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L117-L121" target="_blank">link</a></i></h6><code class="clojure">(enable-task sch :print-task-1)
;; Task runs on schedule when `start!` is called</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__get_task"></span><div class="entry-description"><h4><b>get-task&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>gets a specific task in the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L183-L193" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__get_task" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__get_task"></label><pre class="source"><code class="clojure">(defn get-task
  [scheduler name]
  (first (ova/select (-> scheduler :array :handlers) [:name name])))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L108-L114" target="_blank">link</a></i></h6><code class="clojure">(get-task sch :print-task-1)
;; => #proc{:name :print-task-1,
;;          :mode :async,
;;          :arglist [:timestamp :params :instance]}</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__list_tasks"></span><div class="entry-description"><h4><b>list-tasks&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>lists all tasks in the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L168-L181" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__list_tasks" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__list_tasks"></label><pre class="source"><code class="clojure">(defn list-tasks
  [scheduler]
  (persistent! (-> scheduler :array :handlers)))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L96-L105" target="_blank">link</a></i></h6><code class="clojure">(list-tasks sch)
;; => [#proc{:name :print-task-1,
;;           :mode :async,
;;           :arglist [:timestamp :params :instance]}
;;     #proc{:name :print-task-2,
;;           :mode :async,
;;           :arglist [:timestamp :params :instance] }]</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__reparametise_task"></span><div class="entry-description"><h4><b>reparametise-task&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>changes the schedule for an already existing task</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L257-L266" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__reparametise_task" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__reparametise_task"></label><pre class="source"><code class="clojure">(defn reparametise-task
  [scheduler name opts]
  (dosync (ova/smap! (-> scheduler :array :handlers) [:name name]
                     update-in [:params] merge opts)))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L155-L159" target="_blank">link</a></i></h6><code class="clojure">(-> (scheduler {:hello {:handler (fn [t params] (println params))
                                       :schedule "* * * * * * *"
                        :params {:data "foo"}}})
    (reparametise-task :hello {:data "bar"}))</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__reschedule_task"></span><div class="entry-description"><h4><b>reschedule-task&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>changes the schedule for an already existing task</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L244-L255" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__reschedule_task" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__reschedule_task"></label><pre class="source"><code class="clojure">(defn reschedule-task
  [scheduler name schedule]
  (dosync (ova/smap! (-> scheduler :array :handlers) [:name name]
                     assoc
                     :schedule schedule
                     :schedule-array (tab/parse-tab schedule))))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L148-L152" target="_blank">link</a></i></h6><code class="clojure">(-> (scheduler {:hello {:handler (fn [t params] (println params))
                                     :schedule "* * * * * * *"
                        :params {:data "foo"}}})
    (reschedule-task :hello "/5 * * * * * *"))</code></pre></div></div></div></div><div><span id="instances"></span><h3>3.3 &nbsp;&nbsp; Instances</h3></div><div class="api"><span id="entry__hara_io_scheduler__"></span><hr /><div><ul><li><a data-scroll="" href="#entry__hara_io_scheduler__get_instance">get-instance</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__list_instances">list-instances</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__kill_instance">kill-instance</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__kill_instances">kill-instances</a></li><li><a data-scroll="" href="#entry__hara_io_scheduler__trigger_BANG_">trigger!</a></li></ul><hr style="margin-bottom: 0" /><div><div class="entry"><span id="entry__hara_io_scheduler__get_instance"></span><div class="entry-description"><h4><b>get-instance&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>gets an instance of the running task</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L304-L316" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__get_instance" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__get_instance"></label><pre class="source"><code class="clojure">(defn get-instance
  [scheduler name id]
  (-> scheduler
       :registry
       :store
       deref
       (get-in [name id])))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L178-L182" target="_blank">link</a></i></h6><code class="clojure">(get-instance sch :print-task-1 #inst "2016-10-25T11:39:05.000-00:00")
;; retrieves a running instances in the scheduler</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__list_instances"></span><div class="entry-description"><h4><b>list-instances&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>lists all running instances of a tasks in the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L282-L302" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__list_instances" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__list_instances"></label><pre class="source"><code class="clojure">(defn list-instances
  ([scheduler]
   (for [tsk  (list-tasks scheduler)
         inst (list-instances scheduler (:name tsk))]
     inst))
  ([scheduler name]
   (-> scheduler
       :registry
       :store
       deref
       (get name)
       vals)))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L168-L175" target="_blank">link</a></i></h6><code class="clojure">(list-instances sch)
;; lists all running instances in the scheduler
       
(list-instances sch :print-task-1)
;; lists all running instances for a particular task</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__kill_instance"></span><div class="entry-description"><h4><b>kill-instance&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>kills a single instance of the running task</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L318-L327" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__kill_instance" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__kill_instance"></label><pre class="source"><code class="clojure">(defn kill-instance
  [scheduler name id]
  (-> (get-instance scheduler name id)
      (procedure/kill)))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L185-L189" target="_blank">link</a></i></h6><code class="clojure">(kill-instance sch :print-task-1 #inst "2016-10-25T11:39:05.000-00:00")
;; kills a running instances in the scheduler</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__kill_instances"></span><div class="entry-description"><h4><b>kill-instances&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>kills all instances of the running task</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L329-L344" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__kill_instances" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__kill_instances"></label><pre class="source"><code class="clojure">(defn kill-instances
  ([scheduler]
   (vec (for [inst (list-instances scheduler)]
          (procedure/kill inst))))
  ([scheduler name]
   (vec (for [inst (list-instances scheduler name)]
          (procedure/kill inst)))))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L192-L199" target="_blank">link</a></i></h6><code class="clojure">(kill-instances sch)
;; kills all running instances in the scheduler
       
(kill-instances sch :print-task-1)
;; kills all running instances for a particular task</code></pre></div><div class="entry"><span id="entry__hara_io_scheduler__trigger_BANG_"></span><div class="entry-description"><h4><b>trigger!&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>manually executes a task, bypassing the scheduler</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L268-L280" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__trigger_BANG_" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__trigger_BANG_"></label><pre class="source"><code class="clojure">(defn trigger!
  ([scheduler name]
   (let [opts   (-> scheduler :clock :meta)]
     (trigger! scheduler name (time/now opts))))
  ([scheduler name key]
   (if-let [{:keys [params] :as task} (get-task scheduler name)]
     ((-> task
          (assoc :registry (:registry scheduler)))
      key params {}))))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L163-L165" target="_blank">link</a></i></h6><code class="clojure">(trigger! sch :print-task-1)</code></pre></div></div></div></div><div><span id="simulation"></span><h3>3.4 &nbsp;&nbsp; Simulation</h3></div><div class="api"><span id="entry__hara_io_scheduler__"></span><hr /><div><ul><li><a data-scroll="" href="#entry__hara_io_scheduler__simulate">simulate</a></li></ul><hr style="margin-bottom: 0" /><div><div class="entry"><span id="entry__hara_io_scheduler__simulate"></span><div class="entry-description"><h4><b>simulate&nbsp<a data-scroll="" href="#entry__hara_io_scheduler__">^</a></b></h4><p><i>simulates the scheduler running for a certain interval:</i></p></div><div class="entry-option"><h6><a href="https://github.com/zcaudate/hara/blob/master/src/hara/io/scheduler.clj#L119-L150" target="_blank">v&nbsp;2.2</a></h6><div><input class="source-toggle" id="entry__pre_hara_io_scheduler__simulate" type="checkbox" /><label class="source-toggle" for="entry__pre_hara_io_scheduler__simulate"></label><pre class="source"><code class="clojure">(defn simulate
  [scheduler {:keys [start end step pause mode]}]
  (swap! (-> scheduler :clock :state) assoc :disabled true)
  (let [scheduler (component/start scheduler)
        clk  (-> scheduler :clock :meta)
        start-val (time/to-long start)
        end-val   (time/to-long end)
        step      (cond (nil? step) 1
                        (number? step) step
                        :else (long (/ (time/to-long step) 1000)))
        pause     (or pause 0)
        mode      (or mode :sync)
        timespan  (range start-val end-val (* 1000 step))]
    (doseq [t-val timespan]
      (let [t (time/from-long t-val clk)]
        (reset! (:ticker scheduler)
                {:time t :array (tab/to-time-array t) :instance {:mode mode}})
        (if-not (zero? pause)
          (Thread/sleep pause))))
    (swap! (-> scheduler :clock :state) dissoc :disabled)
    (component/stop scheduler)))</code></pre></div></div><pre><h6><i><a href="https://github.com/zcaudate/hara/blob/master/test/hara/io/scheduler_test.clj#L73-L82" target="_blank">link</a></i></h6><code class="clojure">(simulate
 (scheduler {:print-task {:handler (fn [t params instance]
                                     (str t params))
                          :schedule "/2 * * * * * *"
                          :params   {:value "hello world"}}})
 {:start (java.util.Date. 0)
  :end   (java.util.Date. 100000)
  :pause 10})</code></pre></div></div></div></div><div><span id="walkthrough"></span><h2><b>4 &nbsp;&nbsp; Walkthrough</b></h2></div><div><p><code>hara.io.scheduler</code> has been built around a concept of a tasks and schedulers. We start off by defining basic task:</p></div><div class="code"><pre><code class="clojure">(def print-task
  {:handler (fn [t] (println &quot;TIME:&quot; t))
   :schedule &quot;/2 * * * * * *&quot;})</code></pre></div><div><p>The scheduler is defined as follows</p></div><div class="code"><pre><code class="clojure">(def print-scheduler
  (scheduler {:print-task print-task}))</code></pre></div><div><p>Calling <code>start!</code> on the scheduler results in the task triggering every two seconds:</p></div><div class="code"><pre><code class="clojure">(start! print-scheduler)

;; TIME: #inst &quot;2016-10-24T04:00:00.000-00:00&quot;
;; TIME: #inst &quot;2016-10-24T04:00:02.000-00:00&quot;
;; TIME: #inst &quot;2016-10-24T04:00:04.000-00:00&quot;
;; TIME: #inst &quot;2016-10-24T04:00:06.000-00:00&quot;
;; TIME: #inst &quot;2016-10-24T04:00:08.000-00:00&quot;
;; TIME: #inst &quot;2016-10-24T04:00:10.000-00:00&quot;</code></pre></div><div><p>Calling <code>stop!</code> will stop the scheduler from running:</p></div><div class="code"><pre><code class="clojure">(stop! print-scheduler)
  
;; TIME: #inst &quot;2016-10-24T04:00:12.000-00:00&quot;
;; &lt;OUTPUT STOPS&gt;</code></pre></div><div><span id="schedule"></span><h3>4.1 &nbsp;&nbsp; Schedule</h3></div><div><p>Each task has a <code>:schedule</code> entry. The value is a string specifying when it is supposed to run. The string is of the same format as <code>crontab</code> -  seven elements seperated by spaces. The elements are used to match the time, expressed as seven numbers:</p><pre><code> second minute hour day-of-week day-of-month month year</code></pre><p>The rules for a match between the crontab and the current time are:</p><ul><li><code>A</code>       means match on <code>A</code></li><li><code>&#42;</code>       means match on any number</li><li><code>E1,E2</code>   means match on both <code>E1</code> and <code>E2</code></li><li><code>A-B</code>     means match on any number between <code>A</code> and <code>B</code> inclusive</li><li><code>/N</code>      means match on any number divisible by <code>N</code></li><li><code>A-B/N</code>   means match on any number divisible by <code>N</code> between <code>A</code> and <code>B</code> inclusive</li></ul><p>Where <code>A</code>, <code>B</code> and <code>N</code> are numbers; <code>E1</code> and <code>E2</code> are expressions. All seven elements in the string have to match in order for the task to be triggered.</p></div><div class="code"><pre><code class="clojure">;; Triggered every 5 seconds

&quot;/5 * * * * * *&quot;


;; Triggered every 5 seconds between 32 and 60 seconds

&quot;32-60/5 * * * * * *&quot;

;; Triggered every 5 seconds on the 9th aand 10th
;; minute of every hour on every Friday from June
;; to August between years 2012 to 2020.

&quot;/5  9,10  * 5 * 6-8 2012-2020&quot;</code></pre></div><div><span id="simulation-0"></span><h3>4.2 &nbsp;&nbsp; Simulation</h3></div><div><p>Simulations are a great way to check if the system is working correctly. This allows an entire system to be tested for correctness. How <code>simulate</code> works is that it decouples the <code>clock</code> from the task array and forces tasks to trigger on the range of date inputs provided.</p></div><div class="code"><pre><code class="clojure">(def T1 #inst &quot;1999-12-31T23:59:50.00-00:00&quot;)
(def T2 #inst &quot;2000-01-01T00:00:10.00-00:00&quot;)</code></pre></div><div><p>The simulation is then run from <code>T1</code> to <code>T2</code> and the results are shown instantaneously</p></div><div class="code"><pre><code class="clojure">(def sch1 (scheduler {:print-task print-task}))

(simulate sch1
          {:start T1
           :end   T2})
;; &gt; Hello There : #inst &quot;1999-12-31T23:59:50.000-00:00&quot;
;; &gt; Hello There : #inst &quot;1999-12-31T23:59:52.000-00:00&quot;
;; &gt; Hello There : #inst &quot;1999-12-31T23:59:54.000-00:00&quot;
;; &gt; Hello There : #inst &quot;1999-12-31T23:59:56.000-00:00&quot;
;; &gt; Hello There : #inst &quot;1999-12-31T23:59:58.000-00:00&quot;
;; &gt; Hello There : #inst &quot;2000-01-01T00:00:00.000-00:00&quot;
;; &gt; Hello There : #inst &quot;2000-01-01T00:00:02.000-00:00&quot;
;; &gt; Hello There : #inst &quot;2000-01-01T00:00:04.000-00:00&quot;
;; &gt; Hello There : #inst &quot;2000-01-01T00:00:06.000-00:00&quot;
;; &gt; Hello There : #inst &quot;2000-01-01T00:00:08.000-00:00&quot;</code></pre></div><div><p>We can control the way the simulation is run through other params</p></div><div class="code"><pre><code class="clojure">(simulate sch1
          {:start T1
           :end   T2
           :mode  :async
           :pause 0
           :step  3})
;; &gt; Hello There : #inst &quot;1999-12-31T23:59:56.000-00:00&quot;
;; &gt; Hello There : #inst &quot;2000-01-01T00:00:02.000-00:00&quot;
;; &gt; Hello There : #inst &quot;2000-01-01T00:00:08.000-00:00&quot;
;; &gt; Hello There : #inst &quot;1999-12-31T23:59:50.000-00:00&quot;</code></pre></div><div><p><code>:mode</code> can be either <code>:sync</code> (default) or <code>:async</code>. <code>:step</code> is the number of second to wait to test again and pause is the sleep time in milliseconds.</p></div><div><span id="interval-and-pause"></span><h3>4.3 &nbsp;&nbsp; Interval and Pause</h3></div><div><p>It can be seen that we can simulate the actual speed of outputs by keeping the step as 1 and increasing the pause time to 1000ms</p></div><div class="code"><pre><code class="clojure">(simulate sch1
          {:start T1
           :end   T2
           :mode  :async
           :pause 1000
           :step  1})</code></pre></div><div><span id="speeding-up"></span><h3><i>4.3.1 &nbsp;&nbsp; Speeding Up</i></h3></div><div><p>In the following example, the step has been increased to 2 whilst the pause time has decreased to 100ms. This results in a 20x increase in the speed of outputs.</p></div><div class="code"><pre><code class="clojure">(simulate sch1
          {:start T1
           :end   T2
           :mode  :async
           :pause 100
           :step  2})

;; &gt; Hello There : #inst &quot;1999-12-31T23:59:50.000-00:00&quot;

;;            ... wait 0.1 seconds ...

;; &gt; Hello There : #inst &quot;1999-12-31T23:59:52.000-00:00&quot;

;;            ... wait 0.1 seconds ...

;; &gt; Hello There : #inst &quot;1999-12-31T23:59:54.000-00:00&quot;</code></pre></div><div><p>Being able to adjust these simulation parameters are really powerful testing tools and saves an incredible amount of time in development. For example, we can quickly test the year long output of a task that is scheduled to run once an hour very quickly by making the interval 3600 seconds and the pause time to the same length of time that the task takes to finish.</p></div><div><span id="globals"></span><h3>4.4 &nbsp;&nbsp; Globals</h3></div><div><p>The global defaults are contained in <code>hara.io.scheduler/&#42;defaults&#42;</code>:</p></div><div class="code"><pre><code class="clojure">(println hara.io.scheduler/*defaults*)
=&gt; {:clock {:type &quot;java.util.Date&quot;,
            :timezone &quot;Asia/Kolkata&quot;,
            :interval 1,
            :truncate :second},
    :registry {},
    :cache {},
    :ticker {}}</code></pre></div><div><p>For the purposes of the reader, only the <code>:clock</code> entry of <code>&#42;defaults&#42;</code> is important. To override the defaults, define the scheduler with the settings that needs to be customised. To set the time component used to be <code>java.time.Instant</code>, define the scheduler as follows:</p></div><div class="code"><pre><code class="clojure">(def sch2 (scheduler {:hello {:handler  (fn [t params] (println t))
                              :schedule &quot;/2 * * * * * *&quot;
                              :params {}}}
                     {}
                     {:clock {:type &quot;java.time.Instant&quot;}}
                     ))

(start! sch2)
;;&gt; #&lt;Instant 2016-03-05T03:24:06Z&gt;

;;  ... wait 2 seconds ...

;;&gt; #&lt;Instant 2016-03-05T03:24:08Z&gt;

;;  ... printing out instances of java.time.Instant every 2 seconds ...

(stop! sch2)</code></pre></div><div><span id="date-type"></span><h3>4.5 &nbsp;&nbsp; Date Type</h3></div><div><p>It is also possible to use the clojure map representation (the default in hara.time)</p></div><div class="code"><pre><code class="clojure">(def sch2 (scheduler {:hello {:handler  (fn [t params] (println t))
                              :schedule &quot;/2 * * * * * *&quot;
                              :params {}}}
                     {}
                     {:clock {:type &quot;clojure.lang.PersistentArrayMap&quot;
                              :timezone &quot;GMT&quot;}}))

(start! sch2)

;;&gt; {:day 6, :hour 20, :timezone GMT, :second 38, :month 3,
;;   :type clojure.lang.PersistentHashMap, :year 2016, :millisecond 0, :minute 30}

;;  ... wait 2 seconds ...

;;&gt; {:day 6, :hour 20, :timezone GMT, :second 40, :month 3,
;;   :type clojure.lang.PersistentHashMap, :year 2016, :millisecond 0, :minute 30}

;;  ... printing out instances of java.time.Instant every 2 seconds ...

(stop! sch2)</code></pre></div><div><span id="timezone"></span><h3>4.6 &nbsp;&nbsp; Timezone</h3></div><div><p>Having a <code>:timezone</code> value in the clock will ensure that the right timezone is set. The default will always be the system local time, but it can be set to any timezone. To see this in effect, the <code>Calendar</code> object is used and EST is applied.</p></div><div class="code"><pre><code class="clojure">(def sch2 (scheduler {:hello {:handler  (fn [t params] (println t))
                              :schedule &quot;/2 * * * * * *&quot;
                              :params {}}}
                     {}
                     {:clock {:type &quot;java.util.Calendar&quot;
                              :timezone &quot;EST&quot;}}))

(start! sch2)

;;&gt; #inst &quot;2016-03-06T15:37:38.000-05:00&quot;

;;  ... wait 2 seconds ...

;;&gt; #inst &quot;2016-03-06T15:37:40.000-05:00&quot;

;;  ... wait 2 seconds ...

;;&gt; #inst &quot;2016-03-06T15:37:42.000-05:00&quot;

(stop! sch2)</code></pre></div><div><span id="upgrade-from-cronj"></span><h3>4.7 &nbsp;&nbsp; Upgrade from Cronj</h3></div><div><p><a href='https://github.com/zcaudate/cronj'>cronj</a> was the original scheduling library before the concept became absorbed into the larger <a href='https://docs.caudate.me/hara'>hara</a> ecosystem and the <code>hara.ion.scheduler</code> library was born. Although there was a significant cleanup of the internal components within the scheduler, the architecture has not really changed at all. Most of the original cronj methods have been kept pretty much the same so it should be very quick to move from one to the other.</p><p><a href='https://github.com/zcaudate/cronj'>cronj</a> uses <a href='https://github.com/clj-time/clj-time'>clj-time</a>, a wrapper around <a href='http://www.joda.org/joda-time/'>joda-time</a> to provide for time manipulation. The library has been swapped out in favor of <code>hara.time</code> because it provides a more flexible option.</p><p><code>hara.io.scheduler</code> allows the user to select from a few different time implementations and so while new projects can start with the new <code>java.time.Instant</code> entry, or even the clojure map representation of time. However, many projects will still be working with <a href='http://www.joda.org/joda-time/'>joda-time</a> and this has been supported through another project - <a href='https://github.com/zcaudate/hara.time.joda'>hara.time.joda</a>, which provides joda-time extensions to <code>hara.time</code>.</p></div><div><p>To upgrade to <code>cronj</code> to <code>hara.io.scheduler</code>, all that needs to be done is to add to <code>project.clj</code> dependencies:</p><pre><code>&#91;zcaudate/hara.io.scheduler &quot;2.5.10&quot;&#93;
&#91;joda    &quot;2.9.2&quot;&#93;</code></pre><p>Apart from the initial call to include the scheduler, require the <code>hara.time.joda</code> namespace to load in all the protocol and multimethod hooks.</p></div><div class="code"><pre><code class="clojure">(require '[hara.io.scheduler :refer :all])
(require '[hara.time.joda])</code></pre></div><div><p>Most of the methods have been kept pretty much the same, except the constructor. The previous way of constructing the scheduler looks like this:</p></div><div class="code"><pre><code class="clojure">(require '[cronj.core :as cj])
(def cnj (cj/cronj
          :interval 2
          :entries [{:id       :t1
                     :handler  (fn [dt opts] (println dt) (Thread/sleep 1000))
                     :schedule &quot;* * * * * * *&quot;
                     :enabled  true
                     :opts     {:home &quot;/home/cronj&quot;}}

                    {:id       :t2
                     :handler  (fn [dt opts] (println dt) (Thread/sleep 5000))
                     :schedule &quot;* * * * * * *&quot;
                     :enabled  true
                     :opts     {:ex &quot;example&quot;}}]))</code></pre></div><div><p>Now it looks like this:</p></div><div class="code"><pre><code class="clojure">(require '[hara.io.scheduler :as sch])
(def sch (sch/scheduler
          {:t1 {:handler (fn [t params] (println dt) (Thread/sleep 1000))
                :schedule &quot;* * * * * * *&quot;
                :params   {:home &quot;/home/cronj&quot;}}
           :t2 {:handler (fn [t params] (println dt) (Thread/sleep 5000))
                :schedule &quot;* * * * * * *&quot;
                :params   {:ex &quot;example&quot;}}}
          {}
          {:clock {:type &quot;org.joda.time.DateTime&quot;
                   :interval 2}}))</code></pre></div><div><p>Or for the seperation of config and function, as well as simplification of the interface, it can also look like this:</p></div><div class="code"><pre><code class="clojure">(def sch (sch/scheduler
          {:t1 (fn [t] (println t) (Thread/sleep 1000))
           :t2 (fn [t] (println t) (Thread/sleep 5000))}
          {:t1 {:schedule &quot;* * * * * * *&quot;
                :params   {:home &quot;/home/cronj&quot;}}
           :t2 {:schedule &quot;* * * * * * *&quot;
                :params   {:ex &quot;example&quot;}}}
          {:clock {:type &quot;org.joda.time.DateTime&quot;
                   :interval 2}}))
(sch/start! sch)

;;&gt;#&lt;DateTime 2016-03-07T07:47:04.000+05:30&gt;
;;&gt;#&lt;DateTime 2016-03-07T07:47:04.000+05:30&gt;


;;&gt;#&lt;DateTime 2016-03-07T07:47:05.000+05:30&gt;
;;&gt;#&lt;DateTime 2016-03-07T07:47:05.000+05:30&gt;

;;&gt;#&lt;DateTime 2016-03-07T07:47:06.000+05:30&gt;
;;&gt;#&lt;DateTime 2016-03-07T07:47:06.000+05:30&gt;

(sch/stop! sch)</code></pre></div><div><p>The upgrade is complete.</p></div>
        </div>
      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>

  <script>
  if (true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-31320512-2', 'caudate.me');
    ga('send', 'pageview');
  }
  </script>
  
  <script type="text/javascript">
    smoothScroll.init();
    gumshoe.init({});
  
    hljs.registerLanguage("clojure",function(e){var t={"builtin-name":"def defonce cond apply if-not if-let if not not= = < > <= >= == + / * - rem quot neg? pos? delay? symbol? keyword? true? false? integer? empty? coll? list? set? ifn? fn? associative? sequential? sorted? counted? reversible? number? decimal? class? distinct? isa? float? rational? reduced? ratio? odd? even? char? seq? vector? string? map? nil? contains? zero? instance? not-every? not-any? libspec? -> ->> .. . inc compare do dotimes mapcat take remove take-while drop letfn drop-last take-last drop-while while intern condp case reduced cycle split-at split-with repeat replicate iterate range merge zipmap declare line-seq sort comparator sort-by dorun doall nthnext nthrest partition eval doseq await await-for let agent atom send send-off release-pending-sends add-watch mapv filterv remove-watch agent-error restart-agent set-error-handler error-handler set-error-mode! error-mode shutdown-agents quote var fn loop recur throw try monitor-enter monitor-exit defmacro defn defn- macroexpand macroexpand-1 for dosync and or when when-not when-let comp juxt partial sequence memoize constantly complement identity assert peek pop doto proxy defstruct first rest cons defprotocol cast coll deftype defrecord last butlast sigs reify second ffirst fnext nfirst nnext defmulti defmethod meta with-meta ns in-ns create-ns import refer keys select-keys vals key val rseq name namespace promise into transient persistent! conj! assoc! dissoc! pop! disj! use class type num float double short byte boolean bigint biginteger bigdec print-method print-dup throw-if printf format load compile get-in update-in pr pr-on newline flush read slurp read-line subvec with-open memfn time re-find re-groups rand-int rand mod locking assert-valid-fdecl alias resolve ref deref refset swap! reset! set-validator! compare-and-set! alter-meta! reset-meta! commute get-validator alter ref-set ref-history-count ref-min-history ref-max-history ensure sync io! new next conj set! to-array future future-call into-array aset gen-class reduce map filter find empty hash-map hash-set sorted-map sorted-map-by sorted-set sorted-set-by vec vector seq flatten reverse assoc dissoc list disj get union difference intersection extend extend-type extend-protocol int nth delay count concat chunk chunk-buffer chunk-append chunk-first chunk-rest max min dec unchecked-inc-int unchecked-inc unchecked-dec-inc unchecked-dec unchecked-negate unchecked-add-int unchecked-add unchecked-subtract-int unchecked-subtract chunk-next chunk-cons chunked-seq? prn vary-meta lazy-seq spread list* str find-keyword keyword symbol gensym force rationalize"},r="a-zA-Z_\\-!.?+*=<>&#'",n="["+r+"]["+r+"0-9/;:]*",a="[-+]?\\d+(\\.\\d+)?",o={b:n,r:0},s={cN:"number",b:a,r:0},i=e.inherit(e.QSM,{i:null}),c=e.C(";","$",{r:0}),d={cN:"literal",b:/\b(true|false|nil)\b/},l={b:"[\\[\\{]",e:"[\\]\\}]"},m={cN:"comment",b:"\\^"+n},p=e.C("\\^\\{","\\}"),u={cN:"symbol",b:"[:]{1,2}"+n},f={b:"\\(",e:"\\)"},h={eW:!0,r:0},y={k:t,l:n,cN:"name",b:n,starts:h},b=[f,i,m,p,c,u,l,s,d,o];return f.c=[e.C("comment",""),y,h],h.c=b,l.c=b,{aliases:["clj"],i:/\S/,c:[f,i,m,p,c,u,l,s,d]}});
    hljs.initHighlightingOnLoad();
  </script>
</html>
